<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<nav class="navbar navbar-expand-lg  navbar-custom" >
  <div class="container-fluid">
    <a class="navbar-brand" href="#">
      <img th:src="@{/images/logo.png}"  src="../static/images/logo.png" width="auto" height="80" class="d-inline-block align-top" alt=""/>
    </a>
    <button class="navbar-toggler custom-toggler text-primary" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>


    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto"></ul>
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link navbar-text" th:href="@{/}" href="#">Home</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link navbar-text" th:href="@{/shop}" href="#">Shop</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link navbar-text" sec:authorize="isAnonymous()" th:href="@{/login}" href="#">Login</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link navbar-text" sec:authorize="isAuthenticated()" th:href="@{/logout}" href="#">Logout</a>

        </li>
        <li class="nav-item active">
          <a class="nav-link navbar-text" th:href="@{/user/userDashboard}" href="#">Profile</a>

        </li>
        <li class="nav-item active">
          <a class="nav-link navbar-text" th:href="@{/cart/goToCart}" href="#">Cart</a>
        </li>
        <li class="nav-item active">
          <span class="nav-link navbar-text" th:text="${cartCount}">0</span>
        </li>
      </ul>

    </div>
  </div>
</nav>

<div class="container mt-5">
  <div class="row">
    <div class="col-sm-5 d-flex justify-content-center">
       <img class="mt-5" height="300px" width="300px" src="" th:src="@{${'/productImages/' + product.imageName}}"
           alt="">
    </div>
    <div class="col-sm-7 mt-5">
      <div class="card">
        <div class="card-body">
          <h2 class="card-title" style="color: #FFD800" th:text="${product.name}"></h2><br>
          <h3 class="card-subtitle" style="color: #D3D3D3" th:text="${product.category.name}"></h3>
          <h4 id="variantName" th:text="${variants[0].variantName}" style="color:white"></h4>
          <h4 id="variantPrice" style="color:white">
            â‚¹ <span th:text="${variants[0].price}"></span>
          </h4>

          <select id="variantSelect" class="form-control" name="variant" onchange="fetchVariantDetails()">
                 <option value="0">Select</option>
                 <option th:each="variant : ${variants}"
                         th:value="${variant.id}"
                         th:text="${variant.variantName}">

                 </option>
          </select>

          <p class="card-text mt-4" style="color: #D3D3D3" th:text="${product.description}"></p>

          <div>
            <button class="btn btn-warning" id="addCart" type="button" onclick="addToCart()">Add to cart</button>
            <a class="btn btn-warning" id="goToCart" th:href="@{/cart/goToCart}" style="display: none;">Go to Cart</a>
          </div>

          <div id="message" class="alert alert-success" role="alert" style="display: none;"></div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Customized Footer -->
<footer class="text-center ">
  <div class="container">
    <section class="mb-3">
      <!-- Social Media Links -->
      <a class="btn btn-outline-warning btn-floating m-1" href="#" role="button">
        <i class="fab fa-facebook-f"></i>
      </a>
      <a class="btn btn-outline-warning btn-floating m-1" href="#" role="button">
        <i class="fab fa-instagram"></i>
      </a>
      <a class="btn btn-outline-warning btn-floating m-1" href="#" role="button">
        <i class="fab fa-linkedin-in"></i>
      </a>
      <a class="btn btn-outline-warning btn-floating m-1" href="https://github.com/RawanSayedd" target="_blank" role="button">
        <i class="fab fa-github"></i>
      </a>
    </section>

    <!-- Copyright Notice -->
    <div class="text-center" style="color: #FFD800;">
      <p>&copy; 2023 All rights reserved ashish</p>

    </div>
  </div>
</footer>
<!-- Customized Footer Ends -->

<!-- Add scripts here -->
<script>
  function fetchVariantDetails() {
    const variantSelect = document.getElementById('variantSelect');
        const selectedVariantId = variantSelect.value;

        console.log(selectedVariantId)
        if (+selectedVariantId != 0) {

            fetch(`/variant/get-variant/`+selectedVariantId)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('variantName').innerText = data.variantName;
                    document.getElementById('variantPrice').innerText = data.price;

                })
                .catch(error => {
                    console.error('Error fetching variant details:', error.message);
                });
        } else {
            alert("select variant");
        }
    }



  function showMessage(message, isSuccess) {
        const messageElement = document.getElementById('message');
        messageElement.innerHTML = message;
        messageElement.classList.toggle('alert-success', isSuccess);
        //messageElement.classList.toggle('alert-danger', !isSuccess);


        messageElement.style.display = 'block';



</script>
<script>
  function addToCart() {
  const addCart = document.getElementById('variantSelect').value;
  console.log(addCart)

  fetch('/add/' + addCart)
      .then(response => {
          if (response.ok) {
              return response.text();
          }
          throw new Error('Failed to add to cart');
      })
      .then(data => {
      console.log(data)
          const messageElement = document.getElementById('message');
          messageElement.style.display = 'block';

          if (data === 'Added to cart') {
              messageElement.innerText = data;

              document.getElementById('addCart').style.display = 'none';
              document.getElementById('goToCart').style.display = 'inline';

          } else if (data === 'Out of Stock') {
              messageElement.innerText = data;
              messageElement.style.backgroundColor = "red";
          }
          setTimeout(function () {
              messageElement.style.display = 'none';
          },2000);
      })
      .catch(error => {
          console.error('Error fetching to cart', error.message);
      });
}

</script>

</body>
</html>
